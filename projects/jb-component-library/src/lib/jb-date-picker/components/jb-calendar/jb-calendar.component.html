<jb-calendar-header
  class="mobile-width"
  (reset)="resetPreview()"
  (close)="close.emit()"
></jb-calendar-header>

<jb-selected-display
  [isRangeCalendar]="isRangeCalendar"
  [fromDate]="previewRangeDateFrom"
  [toDate]="previewRangeDateTo"
  [selectedDate]="previewSelectedDate"
  [isFromDateActive]="previewIsFromDateActive"
  class="mobile-width"
></jb-selected-display>

<!-- Only Mobile View -->
<div
  class="flex items-start mobile-width vh-100 flex-auto"
  *ngIf="isMobile; else desktopView"
>
  <div class="flex w-100">
    <div class="w-100">
      <div>
        <hr class="ma0 w-100 mb2 bn bg-light-gray" />
        <div class="db mb1 dn-ns">
          <div
            class="cell h-1-5 w2 dib tc slate-gray h-2"
            *ngFor="let day of weekDays"
          >
            {{ day }}
          </div>
        </div>
        <hr class="ma0 w-100 bn bg-light-gray" />
      </div>
      <div class="absolute mobile-date-content overflow-y-scroll dn-ns">
        <!-- calendar message -->
        <ng-container *ngTemplateOutlet="jbMessageContainer"></ng-container>

        <div *ngFor="let month of availableMonths">
          <div class="tc b core-blue copy tc pv3">
            {{ month | date: 'MMMM yyyy' }}
          </div>
          <div class="db mb3 mt2">
            <!-- Month Display -->
            <ng-container
              [ngTemplateOutlet]="jbCalendarMonthContainer"
              [ngTemplateOutletContext]="{ month: month }"
            ></ng-container>
          </div>
          <hr class="ma0 w-100 bn bg-light-gray" />
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #desktopView>
  <jb-button-close
    class="absolute right-0 pa3"
    fill="core-blue"
    (click)="close.emit()"
    size="large"
  ></jb-button-close>
  <div class="flex-ns items-start w-100 flex-auto">
    <div
      class="flex items-start justify-center w-100"
      [class.mh4]="isTwoMonthDatePicker"
      [class.mh2]="!isTwoMonthDatePicker"
    >
      <button
        #previousMonthButton
        class="previous-month bn pointer bg-transparent"
        aria-label="Previous Month"
        (click)="setPreviousActiveMonths()"
        [disabled]="isPreviousMonthArrowDisabled"
      >
        <jb-icon
          class="flex t-none rotate-90 fill-royal-blue"
          [class.fill-light-gray]="isPreviousMonthArrowDisabled"
          name="chevron"
          height="1.5em"
          width="1.5em"
        ></jb-icon>
      </button>
      <ng-container *ngFor="let month of nextActiveMonths; let i = index">
        <!-- This div is needed for IE and Edge to properly fill the calendar without overflowing -->
        <div
          class="flex-auto calendar-month-container"
          [class.first-month]="i === 0"
          [class.last-month]="i === nextActiveMonths.length - 1"
          [class.two-month]="isTwoMonthDatePicker"
        >
          <div class="tc b core-blue copy tc pb3 pt4">
            {{ month | date: 'MMMM yyyy' }}
          </div>
          <div class="w-100 mb1">
            <div
              class="cell h-1-5 w2 dib tc slate-gray h-2"
              *ngFor="let day of weekDays"
            >
              {{ day }}
            </div>
            <div>
              <!-- Month Display -->
              <ng-container
                [ngTemplateOutlet]="jbCalendarMonthContainer"
                [ngTemplateOutletContext]="{ month: month }"
              ></ng-container>
            </div>
          </div>
        </div>
      </ng-container>
      <button
        #nextMonthButton
        class="next-month bn pointer bg-transparent"
        aria-label="Next Month"
        (click)="setNextActiveMonths()"
        [disabled]="isNextMonthArrowDisabled"
      >
        <jb-icon
          class="flex t-none rotate-270 fill-royal-blue"
          [class.fill-light-gray]="isNextMonthArrowDisabled"
          height="1.5em"
          width="1.5em"
          name="chevron"
        ></jb-icon>
      </button>
    </div>
  </div>
  <ng-container *ngTemplateOutlet="jbMessageContainer"></ng-container>

  <jb-calendar-month-stepper
    [availableMonths]="availableMonths"
    [activeMonths]="activeMonths"
    (monthSelected)="stepperMonthsSelected($event)"
    (selectCurrentMonth)="selectCurrentMonth()"
  ></jb-calendar-month-stepper>
</ng-template>

<button
  jbButton
  *ngIf="showDoneButton"
  [isRounded]="false"
  class="w-100 db dn-ns absolute bottom-0"
  (click)="applyChanges()"
>
  Done
</button>

<ng-template #jbMessageContainer>
  <div
    #calendarMessage
    class="flex flex-column"
    [ngClass]="{
      'calendar-message-container min-h-1 ph5 pv2': elementHasContent(
        calendarMessage
      ),
      mb4: !elementHasContent(calendarMessage)
    }"
  >
    <ng-content></ng-content>
  </div>
</ng-template>

<ng-template #jbCalendarMonthContainer let-month="month">
  <jb-calendar-month
    class="flex flex-column"
    [monthDayArray]="getAllMonthDayArray(month)"
    [isRangeCalendar]="isRangeCalendar"
    [disabledDates]="disabledDates"
    [month]="month"
    [fromDate]="previewRangeDateFrom"
    [toDate]="previewRangeDateTo"
    [isFromDateActive]="previewIsFromDateActive"
    [selectedDate]="previewSelectedDate"
    [defaultDate]="defaultDate"
    [rangeDates]="rangeDates"
    [fromAndToDateAreSame]="fromAndToDateAreSame"
    (updateSelectedDate)="updateSelectedDate($event)"
  ></jb-calendar-month>
</ng-template>
