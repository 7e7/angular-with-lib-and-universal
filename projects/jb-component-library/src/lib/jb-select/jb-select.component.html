<div
  (jbTabOut)="onTouched()"
  (keyup)="handleKeyup($event)"
  (keydown)="handleKeydown($event)"
>
  <label
    *ngIf="isStandardType"
    jbInputLabel
    [isShrunk]="isOpen || hasSelectedOption || isFocused"
  >
    {{ placeholder }}
  </label>
  <div *ngIf="!!autocomplete" class="clip">
    <input
      [value]="autoCompleteValue"
      (change)="onAutoCompleteChange($event)"
      type="text"
      tabindex="-1"
      [attr.aria-hidden]="true"
      [attr.autocomplete]="autocomplete"
      [attr.name]="autocomplete"
    />
  </div>
  <button
    #selectElement
    type="button"
    aria-haspopup="listbox"
    [title]="placeholder"
    [attr.aria-expanded]="isOpen"
    [attr.aria-describedby]="ariaDescribedBy"
    class="bg-white flex flex-row items-center avenir pointer"
    [ngClass]="{
      'ba ph3 jb-input-height slate-gray jb-form-field w-100': isStandardType,
      active: isStandardType && isOpen,
      'core-blue': !isStandardType && isOpen,
      'tl pa0 b bn royal-blue hover-core-blue hover-fill-core-blue': !isStandardType
    }"
    (click)="handleButtonClick()"
    (focus)="isFocused = true"
    (blur)="handleBlur()"
    (keydown)="handleAnchorKeydown($event)"
    jbAnchor
    #anchor="jbAnchor"
    [flyout]="flyout"
  >
    <span class="copy-s b mr2" *ngIf="!isStandardType && !hasSelectedOption">
      {{ placeholder }}
    </span>

    <div
      class="dropdown-text truncate dib"
      [ngClass]="{
        'pt4 pb2 charcoal tl': isStandardType,
        'copy-s b': !isStandardType,
        mr2: hasSelectedOption,
        'selected-option-width': !hasSelectedOption
      }"
    >
      <!-- &nbsp is needed for proper styling on IE 11 -->
      {{ hasSelectedOption ? selectedOption : '&nbsp;' }}
    </div>

    <jb-expandable-indicator
      [ngClass]="{
        'ml-auto': isStandardType
      }"
      [value]="isOpen"
      [hasError]="errorState"
      [iconSize]="iconSize"
    ></jb-expandable-indicator>
  </button>

  <jb-flyout
    #flyout
    (afterOpened)="afterOpenedDropdownMenu()"
    (afterClosed)="afterClosedDropdownMenu(); allowValidate()"
    [offsetY]="!isStandardType ? 8 : 0"
    [visibility]="visibility"
    [horizontalFlipping]="horizontalFlipping"
    [placement]="placement"
    [maxWidth]="isStandardType ? standardMaxWidth : simpleMaxWidth"
    [fitToAnchorWidth]="fitToAnchor || (isStandardType && isMobile)"
    [minWidth]="!isStandardType ? '136' : ''"
  >
    <div
      #listbox
      id="listbox-container"
      role="listbox"
      class="items-list no-max list pl0 w-100 bg-white b--medium-gray outline-0 ma0"
      [ngClass]="{
        'br-rounded-4-bottom': isStandardType,
        'br-rounded-4 ba': !isStandardType,
        'overflow-y-auto': visibleItemsBeforeScrolling
      }"
      [class.dib]="isOpen"
      [attr.aria-hidden]="isAriaHidden"
      tabindex="-1"
      [style.height]="listHeightPx"
      [style.visibility]="visibility"
    >
      <ng-content></ng-content>
    </div>
  </jb-flyout>
</div>
